# 🧪 Telegram Web App 测试指南

## 📋 测试方案概述

由于 Telegram Web App 必须在 Telegram 环境中运行才能访问完整的 API，我们提供了多种测试方案：

### 🎯 测试方案

1. **模拟环境测试** - 在浏览器中模拟 Telegram 环境
2. **本地 HTTPS 测试** - 在本地 HTTPS 环境中测试
3. **服务器部署测试** - 在真实服务器上测试
4. **移动端测试** - 在手机 Telegram 中测试

## 🚀 方案一：模拟环境测试（推荐）

### 特点
- ✅ 无需真实 Telegram 环境
- ✅ 快速开发和调试
- ✅ 完整的 API 模拟
- ✅ 实时日志输出

### 使用方法

#### 1. 启动开发服务器
```bash
npm run dev
```

#### 2. 访问测试页面
```
http://localhost:5173/test
```

#### 3. 测试功能
- 用户信息显示
- 主按钮和返回按钮
- 触觉反馈
- 通知系统
- 主题切换

### 模拟数据
```javascript
// 模拟用户信息
{
  id: 123456789,
  first_name: '测试用户',
  last_name: 'Test',
  username: 'testuser',
  language_code: 'zh',
  is_premium: true,
  photo_url: 'https://via.placeholder.com/150'
}

// 模拟聊天信息
{
  id: -987654321,
  type: 'private',
  title: '测试聊天',
  username: 'testchat'
}
```

## 🌐 方案二：本地开发测试

### 特点
- ✅ 快速开发环境
- ✅ 热重载支持
- ✅ 局域网访问支持

### 使用方法

#### 1. 启动开发服务器
```bash
npm run dev
```

#### 2. 获取本机 IP
```bash
ipconfig getifaddr en0  # macOS
# 或
hostname -I  # Linux
```

#### 3. 访问地址
```
本地访问: http://localhost:5173
局域网访问: http://你的IP地址:5173
```

#### 4. 测试功能
- 在浏览器中测试所有功能
- 使用测试面板验证 API
- 查看实时日志输出

## 🖥️ 方案三：服务器部署测试

### 特点
- ✅ 生产环境测试
- ✅ 真实的用户数据
- ✅ 完整的 Telegram API

### 使用方法

#### 1. 部署到服务器
```bash
npm run deploy:auto
```

#### 2. 配置 Bot
```
Web App URL: https://your-domain.com
```

#### 3. 在 Telegram 中测试
- 真实的用户信息
- 完整的 API 功能
- 生产环境性能

## 📱 方案四：移动端测试

### 特点
- ✅ 真实的移动端体验
- ✅ 触摸手势测试
- ✅ 性能测试

### 使用方法

#### 1. 确保手机和电脑在同一网络

#### 2. 在手机浏览器中访问
```
http://192.168.31.31:5173/test
```

#### 3. 测试功能
- 在手机浏览器中测试响应式布局
- 测试触摸操作
- 验证移动端性能

## 🧪 测试面板功能

### 环境信息
- 运行环境检测（Telegram/浏览器）
- 平台信息显示
- 版本信息
- 主题信息

### 用户信息
- 用户头像和姓名
- 用户 ID 和用户名
- Premium 状态
- 语言设置

### 功能测试
- **主按钮测试**：显示/隐藏/设置文本
- **返回按钮测试**：显示/隐藏
- **触觉反馈测试**：5种不同的触觉效果
- **通知测试**：成功/警告/错误通知
- **主题测试**：浅色/深色/自定义主题
- **其他功能**：展开/关闭/弹窗/确认对话框

### 实时日志
- 所有操作的实时日志
- 时间戳记录
- 日志清空功能

## 🔧 调试工具

### 浏览器开发者工具
```javascript
// 检查 Telegram Web App 对象
console.log(window.Telegram?.WebApp)

// 检查用户信息
console.log(window.Telegram?.WebApp?.initDataUnsafe?.user)

// 检查主题参数
console.log(window.Telegram?.WebApp?.themeParams)
```

### 移动端调试
1. 在手机 Chrome 中访问 `chrome://inspect`
2. 在电脑 Chrome 中打开 `chrome://inspect`
3. 连接设备进行调试

### 网络调试
```bash
# 检查 HTTP 连接
curl http://localhost:5173

# 检查端口是否开放
lsof -i :5173
```

## 📊 测试清单

### 基础功能测试
- [ ] 页面正常加载
- [ ] 用户信息显示
- [ ] 主题适配
- [ ] 响应式布局

### Telegram API 测试
- [ ] 主按钮功能
- [ ] 返回按钮功能
- [ ] 触觉反馈
- [ ] 通知系统
- [ ] 主题设置
- [ ] 应用关闭

### 移动端测试
- [ ] 触摸操作
- [ ] 滚动流畅
- [ ] 性能表现
- [ ] 内存使用

### 兼容性测试
- [ ] 不同设备
- [ ] 不同浏览器
- [ ] 不同网络环境

## 🐛 常见问题

### 1. 模拟环境不工作
**解决方案**：
- 检查浏览器控制台错误
- 确认模拟文件正确导入
- 检查 TypeScript 类型定义

### 2. 端口占用问题
**解决方案**：
- 检查端口 5173 是否被占用
- 使用 `lsof -i :5173` 查看占用进程
- 修改 vite.config.ts 中的端口配置

### 3. 移动端无法访问
**解决方案**：
- 确保手机和电脑在同一网络
- 检查防火墙设置
- 使用正确的 IP 地址

### 4. 开发服务器无法启动
**解决方案**：
- 检查 Node.js 版本
- 重新安装依赖 `npm install`
- 查看错误日志

## 🎯 最佳实践

### 开发阶段
1. **使用模拟环境**进行快速开发
2. **定期在本地 HTTPS 环境**中测试
3. **使用测试面板**验证功能
4. **查看实时日志**调试问题

### 测试阶段
1. **在服务器上部署**进行真实测试
2. **在移动端**测试用户体验
3. **在不同设备**上测试兼容性
4. **监控性能**指标

### 生产阶段
1. **完整的用户测试**
2. **性能监控**
3. **错误追踪**
4. **用户反馈收集**

---

**🎉 现在你可以轻松测试 Telegram Web App 了！**
